@using PagedList.Mvc
@using PagedList
@using VnBookLibrary.Model.Entities;
@using System.Globalization;
@{
    ViewBag.Title = "Trang chủ | VnBook";
    List<Tag> HomeTag = ViewBag.HomeTag;
    List<Tag> AllTag = ViewBag.AllTag;
}
<style>
    .RateYellow {
        color: yellow !important;
    }
</style>
<div>
    <div class="row">
        <div class="col-md-8 col-lg-8">
            <div id="PartialRecommendByCart">

            </div>
            <div>
                @if (HomeTag.Count > 0)
                {
                    var speed = 4500;
                    int t = 0;
                    foreach (var tag in HomeTag)
                    {
                        if (t > 4)
                        {
                            break;
                        }
                        if (tag.Tag_Products.Count > 0)
                        {
                            var tag_product = tag.Tag_Products.ToList();
                            var classcrl = "carousel" + tag.TagId;
                            speed = speed == 4500 ? 4000 : 4500;
                            <div id="carousel-main" class="carousel @classcrl slide " data-ride="carousel" data-interval="@speed" style="margin-bottom:25px;">
                                <h2 style="color:red;text-align:center;margin-bottom:20px">
                                    @tag.TagName

                                    <span>
                                        <a class="left  fa fa-arrow-circle-left fa-lg" href=".@classcrl" style="position:absolute;left:0px;text-decoration:none;font-size:45px;color:green" role="button" data-slide="prev">                                            </a>
                                        <a class="right  fa fa-arrow-circle-right fa-lg" href=".@classcrl" style="position:absolute;right:0px;text-decoration:none;font-size:45px;color:green" role="button" data-slide="next">                                            </a>
                                    </span>
                                </h2>
                                <div class="carousel-inner">
                                    @for (int i = 0; (i + 4) < tag_product.Count && (i + 4) < 20; i = i + 4)
                                    {
                                        var str = i == 0 ? "active" : "";
                                        <div class="item @str">
                                            <div class="row" style="margin-left:-5px!important;margin-right:-5px!important">
                                                @for (int j = i; j < i + 4; j++)
                                                {
                                                    var product = tag_product[j].Product;
                                                    <div class="col-md-3 col-lg-3 col-sm-4 col-xs-6" style="padding:5px!important;margin-bottom:25px;">
                                                        <div class="block2" style="border:1px solid black;border-radius:5px;">
                                                            <div class="block2-img wrap-pic-w of-hidden pos-relative block2-labelnew">
                                                                <div style="height:200px;border-radius:5px 5px 0px 0px">
                                                                    <img title="@product.ProductName" height="100%" style="border-radius:5px 5px 0px 0px" src="@product.AvatarLink" alt="@product.ProductName">
                                                                </div>
                                                            </div>

                                                            <div class="block2-txt p-t-20" style="background:#e9f96f4f;padding:5px 5px;overflow:auto">
                                                                <div style="height:50px;overflow:hidden">
                                                                    <a href='@Url.Action("DetailProduct","Home",new {id=product.ProductId })' style="font-size:13px;font-weight:normal;color:#337ab7;font-weight:bold" title="@product.ProductName">
                                                                        @product.ProductName
                                                                    </a>
                                                                </div>
                                                                <div style="height:35px;overflow:hidden">
                                                                    <span style="display:block;font-size:13px;color:green;font-weight:normal">@product.Price.ToString("c", new CultureInfo("vi-VN")) </span>
                                                                    @if (product.CoverPrice > 0)
                                                                    {
                                                                        <span style="display:block;font-size:13px;color:red;font-weight:normal;text-decoration:line-through">@((product.CoverPrice ?? 0).ToString("c", new CultureInfo("vi-VN")))</span>
                                                                    }
                                                                    <div class="clearfix"></div>
                                                                </div>
                                                                <div style="margin-top:15px;">
                                                                    <a style="color:black" title="Xem chi tiết" href='@Url.Action("DetailProduct","Home",new {id=product.ProductId })' class="btn btn-default"><i style="color:black" class="glyphicon glyphicon-eye-open fa-lg"></i> Xem</a>
                                                                    <button style="float:right" onclick="AddToCart(@product.ProductId)" class="btn btn-danger" title="Thêm vào giỏ" type="button"><i class="fa fa-cart-plus fa-lg" style="color:greenyellow"></i></button>
                                                                    <div class="clearfix"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                        t++;
                    }
                }
            </div>
        </div>
        <div class="col-md-4 col-lg-4">            
            @if ((List<Product>)ViewBag.ReCommendProductByCustomer != null && ((List<Product>)ViewBag.ReCommendProductByCustomer).Count() > 0)
            {
                Html.RenderPartial("~/Views/Home/_RecommendProductByCustomer.cshtml", (List<Product>)ViewBag.ReCommendProductByCustomer);
            }
             <div id="RECOMENDBYCART">

             </div>
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">Các thẻ sách</h3>
                </div>
                <div class="panel-body">
                    @foreach (var tag in AllTag)
                    {
                        <a href="@Url.Action("Tag","Home",new { id=tag.TagId})" style="margin-right:5px;margin-bottom:10px;color:black" class="btn btn-info btn-sm">@tag.TagName</a>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script>
        $(document).ready(function () {
            $('.carousel').carousel({
                pause: 'true',
            })
            LoadRecomendByCart();
        })
    </script>
}
